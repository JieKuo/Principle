<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESD 電場擊穿模擬器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Roboto+Mono:wght@500&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; }
        .mono { font-family: 'Roboto Mono', monospace; }
        
        /* Spark Animation */
        @keyframes flash {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; filter: drop-shadow(0 0 10px #fbbf24); }
            20%, 80% { opacity: 0.5; }
            30%, 50%, 70% { opacity: 1; filter: drop-shadow(0 0 20px #f59e0b); }
            40%, 60% { opacity: 0.2; }
        }
        
        .spark {
            display: none;
            stroke: #fbbf24;
            stroke-width: 4;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            animation: flash 0.2s infinite;
        }

        .breakdown .spark {
            display: block;
        }

        .field-arrow {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-4xl overflow-hidden flex flex-col md:flex-row">
        
        <!-- Controls & Data Panel -->
        <div class="p-8 md:w-1/3 bg-slate-800 text-white flex flex-col justify-between">
            <div>
                <h1 class="text-2xl font-bold mb-2">ESD 擊穿原理</h1>
                <p class="text-slate-400 text-sm mb-6">調整距離 (d) 觀察電場 (E) 的變化與空氣崩潰現象。</p>
                
                <div class="mb-8">
                    <label class="block text-sm font-bold text-slate-300 mb-2">距離 d (mm)</label>
                    <input type="range" id="d-slider" min="0.5" max="10" step="0.1" value="5" class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    <div class="flex justify-between mt-2">
                        <span class="text-xs text-slate-500">近 (0.5mm)</span>
                        <span class="text-xs text-slate-500">遠 (10mm)</span>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="p-4 rounded-lg bg-slate-700/50 border border-slate-600">
                        <div class="text-xs text-slate-400 mb-1">電壓 V (固定)</div>
                        <div class="text-2xl font-mono text-blue-400">5,000 V</div>
                    </div>
                    
                    <div class="p-4 rounded-lg bg-slate-700/50 border border-slate-600">
                        <div class="text-xs text-slate-400 mb-1">距離 d</div>
                        <div class="text-2xl font-mono text-white"><span id="val-d">5.0</span> mm</div>
                    </div>

                    <div class="p-4 rounded-lg bg-slate-700/50 border border-slate-600 transition-colors duration-300" id="e-box">
                        <div class="text-xs text-slate-400 mb-1">電場強度 E = V/d</div>
                        <div class="text-2xl font-mono text-white"><span id="val-e">0.2</span> kV/mm</div>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700">
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <span class="text-sm font-bold text-red-400">擊穿臨界值: 3.0 kV/mm</span>
                </div>
                <p class="text-xs text-slate-500">當 E 超過此值，空氣絕緣失效，產生 Spark。</p>
            </div>
        </div>

        <!-- Visualization Panel -->
        <div class="p-8 md:w-2/3 bg-slate-50 relative flex flex-col items-center justify-center overflow-hidden" id="viz-container">
            
            <!-- Warning Overlay -->
            <div id="warning-overlay" class="absolute top-4 right-4 px-4 py-2 bg-red-100 text-red-600 rounded-full font-bold text-sm opacity-0 transition-opacity duration-200 flex items-center gap-2 border border-red-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                AIR BREAKDOWN!
            </div>

            <!-- SVG Diagram -->
            <svg width="400" height="400" viewBox="0 0 400 400" class="w-full h-full max-w-md">
                
                <!-- Field Lines (Dynamic) -->
                <g id="field-lines" stroke-width="2" stroke-dasharray="4 4" opacity="0.5">
                    <!-- Arrows generated by JS -->
                </g>

                <!-- Top Plate (Source) -->
                <g transform="translate(0, 50)">
                    <rect x="50" y="0" width="300" height="20" fill="#3b82f6" rx="4" />
                    <text x="200" y="-10" text-anchor="middle" fill="#2563eb" font-weight="bold" font-size="14">帶電體 (Source +1kV)</text>
                    <text x="200" y="15" text-anchor="middle" fill="white" font-size="12" class="mono">++++++</text>
                </g>

                <!-- Bottom Plate (Ground) -->
                <g id="ground-plate" transform="translate(0, 300)">
                    <rect x="50" y="0" width="300" height="20" fill="#64748b" rx="4" />
                    <text x="200" y="60" text-anchor="middle" fill="#475569" font-weight="bold" font-size="14">導體/IC接腳 (GND)</text>
                    <!-- Ground Symbol -->
                    <path d="M200 20 L200 35 M185 35 L215 35 M190 40 L210 40 M195 45 L205 45" stroke="#64748b" stroke-width="2" />
                </g>

                <!-- Distance Marker -->
                <g id="distance-marker">
                    <line x1="100" y1="70" x2="100" y2="300" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowhead)" marker-start="url(#arrowhead-rev)" />
                    <rect x="80" y="175" width="40" height="24" fill="#f8fafc" rx="4" />
                    <text x="100" y="192" text-anchor="middle" fill="#64748b" font-weight="bold" font-size="14" id="svg-dist-text">d</text>
                </g>

                <!-- Spark Path -->
                <path id="spark-path" class="spark" d="M200 70 L190 120 L210 180 L195 240 L200 300" />

                <!-- Defs -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#94a3b8" />
                    </marker>
                    <marker id="arrowhead-rev" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
                        <polygon points="10 0, 0 3.5, 10 7" fill="#94a3b8" />
                    </marker>
                </defs>
            </svg>

        </div>
    </div>

    <script>
        const slider = document.getElementById('d-slider');
        const groundPlate = document.getElementById('ground-plate');
        const distanceMarkerLine = document.querySelector('#distance-marker line');
        const distanceMarkerText = document.querySelector('#distance-marker rect');
        const distanceMarkerTextContent = document.querySelector('#svg-dist-text');
        const valD = document.getElementById('val-d');
        const valE = document.getElementById('val-e');
        const eBox = document.getElementById('e-box');
        const vizContainer = document.getElementById('viz-container');
        const warningOverlay = document.getElementById('warning-overlay');
        const fieldLinesGroup = document.getElementById('field-lines');
        const sparkPath = document.getElementById('spark-path');

        // Constants
        const VOLTAGE = 5; // 1kV
        const TOP_Y = 70; // Bottom of top plate
        const MAX_BOTTOM_Y = 300; // Top of bottom plate at max distance
        const MIN_BOTTOM_Y = 100; // Top of bottom plate at min distance
        const SCALE_FACTOR = 20; // Visual pixels per mm roughly

        function generateFieldLines() {
            fieldLinesGroup.innerHTML = '';
            for(let i=0; i<7; i++) {
                const x = 120 + i * 26.6; // Distribute across width
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x);
                line.setAttribute("y1", TOP_Y);
                line.setAttribute("x2", x);
                line.setAttribute("y2", MAX_BOTTOM_Y); // Default, updated in render
                line.setAttribute("class", "field-arrow");
                line.setAttribute("stroke", "#cbd5e1");
                line.setAttribute("stroke-width", "2");
                fieldLinesGroup.appendChild(line);
            }
        }

        function updateSimulation() {
            const d = parseFloat(slider.value);
            const E = VOLTAGE / d; // kV/mm
            
            // Update Text
            valD.textContent = d.toFixed(1);
            valE.textContent = E.toFixed(2);

            // Update Logic: Breakdown threshold ~ 3 kV/mm
            const isBreakdown = E >= 3.0;

            // Visual Updates
            // Map d (0.5 - 10) to Y position (closer - farther)
            // Let's keep top fixed, move bottom up
            // Max d=10 -> Bottom=350, Min d=0.5 -> Bottom=90
            // Actually let's map visual distance linearly for clarity, though d is linear
            // Let visual gap be: d * 25px
            const visualGap = d * 25;
            const currentBottomY = TOP_Y + visualGap;

            groundPlate.setAttribute('transform', `translate(0, ${currentBottomY})`);
            
            // Update Marker
            distanceMarkerLine.setAttribute('y2', currentBottomY);
            // Center text
            const midY = TOP_Y + (visualGap / 2);
            distanceMarkerText.setAttribute('y', midY - 12);
            distanceMarkerTextContent.setAttribute('y', midY + 5);

            // Update Field Lines
            const lines = fieldLinesGroup.querySelectorAll('line');
            lines.forEach(line => {
                line.setAttribute('y2', currentBottomY);
                // Color based on intensity
                if (E < 1) line.setAttribute('stroke', '#22c55e'); // Green
                else if (E < 3) line.setAttribute('stroke', '#f97316'); // Orange
                else line.setAttribute('stroke', '#ef4444'); // Red
                
                // Density/Opacity illusion (optional)
                line.setAttribute('opacity', Math.min(1, E/2)); 
            });

            // Update Spark
            // Generate a random jagged path for the spark
            const segments = 6;
            let pathD = `M200 ${TOP_Y}`;
            const stepY = visualGap / segments;
            for(let i=1; i<segments; i++) {
                const zig = (Math.random() - 0.5) * 30; // Random x offset
                pathD += ` L${200 + zig} ${TOP_Y + stepY * i}`;
            }
            pathD += ` L200 ${currentBottomY}`;
            sparkPath.setAttribute('d', pathD);

            // Breakdown States
            if (isBreakdown) {
                vizContainer.classList.add('breakdown');
                warningOverlay.style.opacity = '1';
                eBox.classList.remove('bg-slate-700/50');
                eBox.classList.add('bg-red-900/80', 'border-red-500');
            } else {
                vizContainer.classList.remove('breakdown');
                warningOverlay.style.opacity = '0';
                eBox.classList.add('bg-slate-700/50');
                eBox.classList.remove('bg-red-900/80', 'border-red-500');
            }
        }

        // Init
        generateFieldLines();
        slider.addEventListener('input', updateSimulation);
        updateSimulation(); // First run

        // Animate spark jitter
        setInterval(() => {
            if (parseFloat(slider.value) <= 0.34 || (VOLTAGE/parseFloat(slider.value)) >= 3.0) {
                 // Re-generate spark path occasionally or just rely on CSS anim?
                 // Let's redraw path slightly for realism if breaking down
                 const d = parseFloat(slider.value);
                 const visualGap = d * 25;
                 const currentBottomY = TOP_Y + visualGap;
                 
                 const segments = 6;
                 let pathD = `M200 ${TOP_Y}`;
                 const stepY = visualGap / segments;
                 for(let i=1; i<segments; i++) {
                     const zig = (Math.random() - 0.5) * 40; 
                     pathD += ` L${200 + zig} ${TOP_Y + stepY * i}`;
                 }
                 pathD += ` L200 ${currentBottomY}`;
                 sparkPath.setAttribute('d', pathD);
            }
        }, 100);

    </script>
</body>
</html>